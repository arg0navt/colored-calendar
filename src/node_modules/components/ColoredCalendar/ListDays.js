import React from "react";
import moment from "moment";
import {Day, DayShadow} from "./Day";
import PropTypes from "prop-types";

const monthWeekLength = 5;
export default class ListDays extends React.Component {
  constructor(props) {
    super(props);
    this.state = {
      arrayList: [],
    };
    this.renderDays = this.renderDays.bind(this);
  }
  
  componentWillMount() {
    this.setArrayList(monthWeekLength, this.props);
  }
  
  componentWillReceiveProps(nextProps) {
    if (nextProps.date !== this.props.date) {
      this.setArrayList(monthWeekLength, nextProps);
    }
  }

  componentWillUnmount() {}
  
  getStartEndMonth = (props) => ({
    start: moment(props.date).startOf("month").startOf("week"),
    end: moment(props.date).endOf("month").endOf("week")
  });
  
  setArrayList(sizeWeeks, props) {
    const arrayList = [];
    for (let weekNumber = 0; weekNumber <= sizeWeeks; weekNumber++) {
      let n = this.getStartEndMonth(props).start;
      for (let dayNumber = 0; dayNumber <= 6; dayNumber++) {
        arrayList.push(moment(n).add({week: weekNumber, days: dayNumber}));
      }
    }
    this.setState({arrayList});
  }
  
  renderDays() {
    return this.state.arrayList.map((day) => {
      if (day.month() !== this.props.date.month()) {
        return <DayShadow
          dateMonth={this.props.date}
          setMonth={this.props.setNumberMonth}
          key={day.format("DDMMYYYY")}
          day={day}
        />;
      } else return <Day
        dateMonth={this.props.date}
        key={day.format("DDMMYYYY")}
        day={day}
      />;
    });
  }
  
  render() {
    return <div className="Date-Month__month">{this.renderDays()}</div>;
  }
}

ListDays.contextTypes = {
  limit: PropTypes.number,
  activeRange: PropTypes.object,
};